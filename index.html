<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="icon.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Dotra ‚Äì Mine. Fair. Together.</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css?v=11" />
    <style>
      html, body {
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
      }
    </style>
  </head>
  <body>
    <header class="main-nav">
      <nav>
        <a href="whitepaper.html" class="nav-btn">Whitepaper</a>
      </nav>
    </header>

    <main class="hero">
      <div class="logo-wrapper">
        <img src="icon.png" alt="Dotra Logo" class="center-logo" id="logo" />
      </div>

      <div class="typewriter" id="typing-text"></div>

      <div class="download-links" id="download">
        <a class="store-link" href="#"><img src="appstore.png" alt="App Store" /></a>
        <a class="store-link" href="#"><img src="playstore.png" alt="Google Play" /></a>
      </div>

      <div class="quick-sections">
        <div class="info-cluster fade-in">
          <h2>What is Dotra?</h2>
          <p>Dotra is a next-generation mining system built for fairness, accessibility, and transparency. No hardware. No fees. Just your time and engagement.</p>
        </div>

        <div class="cards fade-in">
          <div class="card">
            <h3>üîì Access for All</h3>
            <p>Anyone can start mining. All you need is your phone ‚Äì no investment required.</p>
          </div>
          <div class="card">
            <h3>‚ö° Activity-Based</h3>
            <p>Your mining power grows as you engage. Activity equals value in our ecosystem.</p>
          </div>
          <div class="card">
            <h3>üåê Community First</h3>
            <p>We prioritize users. No whales, no pay-to-win. Just decentralized contribution.</p>
          </div>
        </div>

        <div class="info-cluster fade-in">
          <h2>Why Dotra?</h2>
          <p>Because value should be earned ‚Äì not bought. Dotra rewards participation, not capital.</p>
        </div>

        <div class="info-cluster fade-in" id="stats-box">
          <h2>üìä Live Mining Stats</h2>
          <p><strong>Total DOTRA Mined:</strong> <span id="dotraCount">Loading...</span></p>
          <p><strong>Registered Users:</strong> <span id="userCount">Loading...</span></p>
        </div>
      </div>
    </main>

    <section class="contact-form fade-in">
      <h2>Kontaktiere uns</h2>
      <form id="contactForm" action="https://formspree.io/f/dotraapp@gmail.com" method="POST">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" required>
        </div>
        <div class="form-group">
          <label for="email">E-Mail</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
          <label for="message">Nachricht</label>
          <textarea id="message" name="message" rows="4" required></textarea>
        </div>
        <button type="submit" class="submit-btn">Absenden</button>
      </form>
    </section>

    <footer>
      <p>&copy; 2025 Dotra. Alle Rechte vorbehalten.</p>
    </footer>

    <script>
      // Formular-Handler
      async function handleSubmit(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData);
        
        try {
          const response = await fetch('/api/send-email', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });

          const result = await response.json();

          if (response.ok) {
            event.target.reset();
            alert('Vielen Dank f√ºr Ihre Nachricht! Wir werden uns in K√ºrze bei Ihnen melden.');
          } else {
            throw new Error(result.error || 'Ein Fehler ist aufgetreten');
          }
        } catch (error) {
          console.error('Fehler beim Senden:', error);
          alert('Entschuldigung, es gab ein Problem beim Senden Ihrer Nachricht. Bitte versuchen Sie es sp√§ter erneut.');
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        const text = "Welcome to Dotra...";
        const typingElement = document.getElementById("typing-text");
        const download = document.getElementById("download");

        if (!typingElement || !download) return;

        typingElement.style.visibility = 'visible';
        typingElement.style.opacity = '1';

        let i = 0;
        function type() {
          if (i < text.length) {
            typingElement.textContent += text.charAt(i);
            i++;
            setTimeout(type, 80);
          } else {
            download.classList.add("show-links");
          }
        }

        setTimeout(type, 500);

        const fadeInElements = document.querySelectorAll('.fade-in');
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, { threshold: 0.1 });

        fadeInElements.forEach(el => observer.observe(el));

        // Fetch stats
        fetch("https://dotranew-production.up.railway.app/stats")
          .then(res => res.json())
          .then(data => {
            animateValue("dotraCount", 0, data.totalDotra, 2000, " DOTRA");
            animateValue("userCount", 0, data.totalUsers, 2000, " users");
          })
          .catch(err => {
            console.error("Stats fetch error:", err);
            document.getElementById("dotraCount").textContent = "N/A";
            document.getElementById("userCount").textContent = "N/A";
          });

        function animateValue(id, start, end, duration, suffix) {
          const el = document.getElementById(id);
          let startTimestamp = null;
          const step = timestamp => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const value = Math.floor(progress * (end - start) + start);
            el.textContent = value.toLocaleString() + suffix;
            if (progress < 1) {
              window.requestAnimationFrame(step);
            }
          };
          window.requestAnimationFrame(step);
        }
      });
    </script>
  </body>
</html>
